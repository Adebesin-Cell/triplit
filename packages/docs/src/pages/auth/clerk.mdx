---
description: Learn how to setup user auth for your Triplit application with Clerk.
---

import { Steps, Callout, Tabs, Tab } from 'nextra/components';

# Using Clerk with Triplit

[Clerk](https://clerk.com) is a user authentication and management service that makes it easy to add user accounts to your application. It's super simple to get Clerk up and running with Triplit, and this guide will show you how.

<Callout>
  This guide assumes you have a Triplit project set up. If you don't have one,
  you can create one by following the [Quick Start](/quick-start) guide.
</Callout>

<Steps>

### Create a Clerk account and application

Follow the official [Clerk documentation](https://docs.clerk.dev/) to create an account and application in their dashboard.

### Create a JWT Template in Clerk

Triplit authenticates users using JWT tokens. Clerk issues JWT tokens when a user logs in. In order for Triplit to validate these tokens, the JWT token must be in a specific format.

In the Clerk dashboard, go to the **JWT Templates** section and click **New template** and then select the **Blank** preset.

![Clerk JWT Template options](/clerk-auth-guide/jwt-template-selection.png)

Then add the following claims, where `<my-project-id>` is your Triplit project ID:

![Clerk JWT Template Claims](/clerk-auth-guide/jwt-template-claims.png)

If you created your Triplit project in the [Dashboard](https://triplit.dev/dashboard), you can find your project on the **Settings** tab of your project.

![Triplit Project ID](/dashboard-screenshots/project-id.png)

If you're not using the Dashboard yet, you can make up a project ID. It just needs to be a unique string.

Note that we've also included the `{{user.id}}` shortcode in the `userId` claim. This will be replaced with the user's Clerk ID when the token is issued, which will be useful when we add permissions to our Triplit schema. [Read more about Clerk shortcodes here](https://clerk.com/docs/backend-requests/making/jwt-templates#shortcodes).

### Get your Clerk public key

We also need to configure Triplit to validate the JWT tokens issued by Clerk. To do this, we need the RSA public key for your Clerk application. You can find this in the **API Keys** section of the Clerk dashboard.

![Clerk API Keys](/clerk-auth-guide/api-keys-overview.png)

Then click on the **Show JWT Public Key** button to reveal the public key.

![Clerk JWT Public Key](/clerk-auth-guide/api-keys-public-key.png)

For local dev, add this, and the project id you used above, to your `.env` file in your Triplit app, making sure to remove any newlines:

```env
TRIPLIT_PROJECT_ID=your-project-id
TRIPLIT_EXTERNAL_JWT_SECRET=-----BEGIN PUBLIC KEY-----<some-encoded-stuff>-----END PUBLIC KEY-----
```

### Start the Triplit development server

Now that we've configured Clerk and added the necessary environmental variables, we can start the Triplit development server:

```bash
npx triplit dev
```

### Add Clerk to your Triplit app

You can add Clerk to your Triplit app by installing the appropriate SDK. Clerk has official support for [Vanilla JavaScript](https://clerk.com/docs/quickstarts/javascript), [React](https://clerk.com/docs/quickstarts/react), [Next.js](https://clerk.com/docs/quickstarts/nextjs), [Expo](https://clerk.com/docs/quickstarts/expo), and more.

There are also community SDKs for frameworks like [Svelte](https://github.com/markjaquith/clerk-sveltekit), [Vue](https://vue-clerk.vercel.app/), and [Angular](https://github.com/anagstef/ngx-clerk?tab=readme-ov-file#ngx-clerk). See the [Clerk documentation](https://clerk.com/docs) for the full list of integrated frameworks.

### Add the Clerk token to your Triplit client

Your Triplit client needs to send the JWT token issued by Clerk with each request. You can do this with the `updateToken` method for the `TriplitClient`.

```ts copy
// get the Clerk client or session using your framework
// e.g. `const auth = useAuth()` from @clerk/clerk-react
// then load the token using the template you created
auth.getToken({ template: 'triplit' }).then((token) => {
  token && client.updateToken(token);
});
```

### Test locally

Run you Triplit app and sign in with Clerk. If youâ€™re setup correctly, you should see the connection is established and your data is syncing with your server. If you can't connect, ensure that you set the `TRIPLIT_PROJECT_ID` and `TRIPLIT_EXTERNAL_JWT_SECRET` environmental variables correctly.

### Configure your Triplit dashboard

To use Clerk with a deployed Triplit server, you just need ensure that it can use the Clerk public key to verify incoming requests.

If you're using the Triplit Dashboard, you can add the public key to the **External JWT secret** input in your project settings.

![Triplit Project Settings](/dashboard-screenshots/authentication.png)

If you're using a custom self-hosted server, you need to set the `EXTERNAL_JWT_SECRET` environmental variable to the public key.

### Add access control to your schema

Now that you have a user auth system set up, you can add roles and permissions to your Triplit schema. [Read more about roles and permissions](/docs/roles-and-permissions).

</Steps>
